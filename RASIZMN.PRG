SELECT 0
USE RASHODN INDEX RASHINKN,RASHINDN
B = LASTREC()
B = B + 1

DO WHILE .T.
   WBROJ = Space(10)
   
   MainMask("IZMENA PODATAKA U KNJIZI PRIHODA-RASHODA (ESC - Izlaz)")
   @ 10,10 SAY "UNESITE BROJ KALKULACIJE(POP./NIV.)" GET WBROJ
   READ
   
   IF Lastkey() = 27
      EXIT
   ENDIF
   
   SEEK WBROJ
   IF !Found()
      @ 20,10 SAY "NEMA TAKVE STAVKE U KNJIZI RASHODA"
      WAIT ""
      LOOP
   ENDIF

   Wimapor = 0
   DN = " "
   WRRB = VAL("0000")
   WRRB = RRB
   WRDK = RDK
   WROPIS = ROPIS
   WRBR = RBR
   WRDATDOK = RDATDOK
   WRPV = RPV
   WRPN = RPN
   WRPN1 = RPN1
   WRPBEZ = RPBEZ
   WOBRPDV = RPBEZ06
   WPREPDV = RPBEZ2
   WUPLPDV = RPBEZ4
   WRUSP = RUSP
   WRUSBEZP = RUSBEZP
   WROSP = RPLACP
   WRSVEP = RSVEP
   wrsvepp = rsvep
   WRNVRRR = RNVRRR
   WRVSP = RVSP
   WRRUCP = RRUCP
   WROBPOR = ROBPOR
   WROBPORU = ROBPORU
   WRPRODV = RPRODV
   WRMIN = RMIN
   WRDOP = RDOP
   WRRASF = RRASF
   WRRASUK = RRASUK
   WRZIRU = RZIRU
   WRZIRI = RZIRI
   WRSK = RSK

   * DO RASMIZNN - ranije je ovaj fajl radio sledeci segment koda
	**********************************************************
	MainMask("IZMENA PODATAKA U KNJIZI PRIHODA-RASHODA (ESC - Izlaz)")   

   @ 2,1   SAY "REDNI BROJ                   "
   @ 2,31  SAY WRRB PICTURE "9999"
   @ 2,40  SAY "DATUM KNJIZENJA" GET WRDK
   @ 3,1   SAY "BROJ DOKUMENTA               " GET WRBR
   @ 3,42  SAY "OPIS" GET WROPIS
   @ 4,1   SAY "DATUM DOKUMENTA ZA KNJIZENJE " GET WRDATDOK
   @ 5,1   SAY "PRIHOD OD DOBARA SA PDV OPSTA" GET WRPV PICTURE "999999999999.99"
   @ 6,1   SAY "PRIHOD OD DOBARA SA PDV POSE." GET WRPN PICTURE "999999999999.99"
   @ 7,1   SAY "PRIHOD OD DOBARA BEZ PDV     " GET WRPBEZ PICTURE "999999999999.99"
   @ 8,1   SAY "PRIHOD OD USLUGA SA PDV      " GET WRUSP PICTURE "999999999999.99"
   @ 9,1   SAY "PRIHOD OD USLUGA BEZ PDV     " GET WRUSBEZP PICTURE "999999999999.99"
   @ 10,1  SAY "OSTALI PRIHODI (63 DO 69)    " GET WROSP PICTURE "999999999999.99"
   @ 11,1  SAY "SVEGA PRIHODA                " GET WRSVEP PICTURE "999999999999.99"
   @ 12,1  SAY "OBRACUNATI PDV " GET WOBRPDV PICTURE "999999999999.99"
   @ 12,33 SAY "PRETHODNI PDV " GET WPREPDV PICTURE "999999999999.99"
   @ 13,1  SAY "UPLACEN PDV                  " GET WUPLPDV PICTURE "999999999999.99"
   @ 14,1  SAY "NAB.VRED.ROBE,REPRO.REZ.DEL  " GET WRNVRRR PICTURE "999999999999.99"
   @ 15,1  SAY "VRED.SOPSTVEN.PROIZVODA      " GET WRVSP PICTURE "999999999999.99"
   @ 16,1  SAY "RAZLIKA U CENI,PROVIZIJA     " GET WRRUCP PICTURE "999999999999.99"
   @ 17,1  SAY "OBRACUNAT PDV                " GET WROBPOR PICTURE "999999999999.99"
   @ 18,1  SAY "PROD.VRADNOST ROB. I PROIZ.  " GET WRPRODV PICTURE "999999999999.99"
   @ 19,1  SAY "TR.ZARAD.NAKNAD.OST.LI.RA(52)" GET WRDOP PICTURE "999999999999.99"
   @ 20,1  SAY "TR.PR.U.NEMAT.TROS. I AMORT. " GET WRMIN PICTURE "999999999999.99"
   @ 21,1  SAY "FINAN.I OSTALI RASHODI(56-59)" GET WRRASF PICTURE "999999999999.99"
   @ 22,1  SAY "RASHODI                      " GET WRRASUK PICTURE "999999999999.99"
   @ 23,1  SAY "TEKUCI RA UPLACENO/ISPLACENO " GET WRZIRU PICTURE "999999999999.99"
   @ 23,52 GET WRZIRI PICTURE "999999999999.99"
   @ 23,68 SAY "S/K  0/1" GET WRSK PICTURE "9"

   READ

	IF Lastkey() = 27
      EXIT
	ENDIF

   wrsvep = round(wrpv + wrpn + wrpbez + wrusp + wrusbezp + wrosp,2)
   @ 11,1  SAY "SVEGA PRIHODA                "
   @ 11,31 SAY WRSVEP PICTURE "999999999999.99"

   wrrasuk = round(wrnvrrr + wrmin + wrdop + wrrasf,2)
   @ 22,1  SAY "RASHODI                      "
   @ 22,31 SAY WRRASUK PICTURE "999999999999.99"
   **********************************************************
   
   @ 24,24 SAY "Upis D/N? " GET DN PICTURE "!" VALID(DN $ "DN")
   READ
   IF Lastkey() = 27
      EXIT
   ENDIF
   
   IF DN = "N"
      LOOP
   ENDIF

   REPLACE RRB WITH WRRB
   REPLACE RDK WITH WRDK
   REPLACE ROPIS WITH WROPIS
   REPLACE RBR WITH WRBR
   REPLACE RDATDOK WITH WRDATDOK
   REPLACE RPV WITH WRPV
   REPLACE RPN WITH WRPN
   REPLACE RPN1 WITH WRPN1
   REPLACE RPBEZ WITH WRPBEZ
   REPLACE RPBEZ06 WITH WOBRPDV
   REPLACE RPBEZ2 WITH WPREPDV
   REPLACE RPBEZ4 WITH WUPLPDV
   REPLACE RUSP WITH WRUSP
   REPLACE RUSBEZP WITH WRUSBEZP
   REPLACE RPLACP WITH WROSP
   REPLACE RSVEP WITH WRSVEP
   REPLACE RNVRRR WITH WRNVRRR
   REPLACE RVSP WITH WRVSP
   REPLACE RRUCP WITH WRRUCP
   REPLACE ROBPOR WITH WROBPOR
   REPLACE ROBPORU WITH WROBPORU
   REPLACE RPRODV WITH WRPRODV
   REPLACE RMIN WITH WRMIN
   REPLACE RDOP WITH WRDOP
   REPLACE RRASF WITH WRRASF
   REPLACE RRASUK WITH WRRASUK
   REPLACE RZIRU WITH WRZIRU
   REPLACE RZIRI WITH WRZIRI
   REPLACE RSK WITH WRSK

   IF WRSvePP <> WRSveP
      SELECT 0
      USE POREZN INDEX POREZND,POREZNB,POREZNBB
      SEEK wrdk
      IF Found()
         DO WHILE wrdk = datk
            IF PAZAR > 0
               Wimapor = 1
               REPLACE PAZAR WITH WRSveP
               EXIT
            ENDIF
            SKIP
         ENDDO
         
         IF Wimapor = 0
            @ 24,50 SAY "U POREZIMA NEMA PAZARA"
            WAIT " "
            CLOSE POREZN
            SELECT RASHODN
         ENDIF
      ELSE
         @ 24,50 SAY "U POREZIMA NEMA PAZARA"
         WAIT " "
         CLOSE POREZN
         SELECT RASHODN
      ENDIF
   ENDIF
   B = B + 1
ENDDO

CLOSE RASHODN
RETURN
