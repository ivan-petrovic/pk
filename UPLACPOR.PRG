ERASE PLACPOR1.DBF
ERASE PLACPOR1.NTX

DbPlacp()
DbPlacpnas()

SELECT 0
USE PLACPNAS

SELECT 0
USE PLACP INDEX PLACP

mDplacpor = Date()
mPer      = Val("0")
mozPer    = Val("0")
mBrnal    = Val("00000")
mPPOP73   = Val("00000000.00")
mPPUS05   = Val("00000000.00")
mPPNV46   = Val("00000000.00")
mPPSREC81 = Val("00000000.00")
mPPKPC03  = Val("00000000.00")
mPORNDO22 = Val("00000000.00")
mDOPVL43  = Val("00000000.00")
mFINTRA50 = Val("00000000.00")
mPORIM82  = Val("00000000.00")
mPORSRE66 = Val("00000000.00")
mPORPAU36 = Val("00000000.00")
mGGZEM    = Val("00000000.00")
mREZ1     = Val("00000000.00")
mREZ2     = Val("00000000.00")
mREZ3     = Val("00000000.00")

SELECT PLACPNAS
mcPPKPC03  = CPPKPC03
mcPORNDO22 = CPORNDO22
mcDOPVL43  = CDOPVL43
mcFINTRA50 = CFINTRA50
mcPORIM82  = CPORIM82
mcPORSRE66 = CPORSRE66
mcPORPAU36 = CPORPAU36
mcGGZEM    = CGGZEM

* mcPPLEL80  = Space(18)
* mcPPLEO87  = Space(18)
* mcPPKOMU53 = Space(18)
* mcPPFINU60 = Space(18)
* mcPPUUT67  = Space(18)
* mcPPUEST74 = Space(18)
* mcPPUAUT88 = Space(18)

SELECT PLACP

mREZ11    = Space(18)
mREZ22    = Space(18)
mREZ33    = Space(18)
mPPLEL80  = Val("00000000.00")
mPPLEO87  = Val("00000000.00")
mPPKOMU53 = Val("00000000.00")
mPPFINU60 = Val("00000000.00")
mPPUUT67  = Val("00000000.00")
mPPUEST74 = Val("00000000.00")
mPPUAUT88 = Val("00000000.00")
dn = "D"

DO WHILE .T.
   MainMask("UNOS PLACENOG POREZA")

   @  2,27 SAY "UNOS STAVKI UPLACENOG POREZA"
   @  4, 3 SAY "DATPLACP"
   @  4,32 SAY "BR.IZVODA"
   @  4,48 SAY "PER"
   @  4,55 SAY "OZPER"
   @  5, 3 SAY "POREZ             "
   @  6, 3 SAY "PIO               "
   @  7, 3 SAY "ZDRAVSTVO         "
   @  8, 3 SAY "NEZAPOSLENOST     "

   @  5,40 SAY "P/P LEK LISTA   80"
   @  6,40 SAY "P/P LEK OSTALI  87"
   @  7,40 SAY "P/P KOMUNA.USL. 53"
   @  8,40 SAY "P/P FIN.USLUGA  60"
   @  9,40 SAY "P/P UG.TUR.USL. 67"
   @ 10,40 SAY "P/P USL.ESTRADA 74"
   @ 11,40 SAY "P/P USL.AUT.PAU.88"

   @  4,18 GET mDplacpor
   @  4,42 GET mBrnal    PICTURE "99999"
   @  4,52 GET mpER      PICTURE "9"
   @  4,61 GET moZPER    PICTURE "9"
   @  5,22 GET mPPOP73   PICTURE "99999999.99"
   @  6,22 GET mPPUS05   PICTURE "99999999.99"
   @  7,22 GET mPPNV46   PICTURE "99999999.99"
   @  8,22 GET mPPSREC81 PICTURE "99999999.99"
   @  9, 3 GET mcPPKPC03   && SAY "P/P KPC 03        "
   @  9,22 GET mPPKPC03  PICTURE "99999999.99"
   @ 10, 3 GET mcPORNDO22  && SAY "POREZ NA DOHODAK22"
   @ 10,22 GET mPORNDO22 PICTURE "99999999.99"
   @ 11, 3 GET mcDOPVL43   && SAY "DOPRINOSI VLASN.43"
   @ 11,22 GET mDOPVL43  PICTURE "99999999.99"
   @ 12, 3 GET mcFINTRA50  && SAY "FINAN.TRANSAKCI.50"
   @ 12,22 GET mFINTRA50 PICTURE "99999999.99"
   @ 13, 3 GET mcPORIM82   && SAY "POREZ NA IMOVINU82"
   @ 13,22 GET mPORIM82  PICTURE "99999999.99"
   @ 14, 3 GET mcPORSRE66  && SAY "POREZ SRECA 66    "
   @ 14,22 GET mPORSRE66 PICTURE "99999999.99"
   @ 15, 3 GET mcPORPAU36  && SAY "POREZ PAUSAL 36   "
   @ 15,22 GET mPORPAU36 PICTURE "99999999.99"
   @ 16, 3 GET mcGGZEM     && SAY "GRADSKO ZEMLJISTE "
   @ 16,22 GET mGGZEM    PICTURE "99999999.99"

   @ 17, 3 GET mREZ11
   @ 17,22 GET mREZ1 PICTURE "99999999.99"
   @ 18, 3 GET mREZ22
   @ 18,22 GET mREZ2 PICTURE "99999999.99"
   @ 19, 3 GET mREZ33
   @ 19,22 GET mREZ3 PICTURE "99999999.99"
   * polja za kumulative
   * mcPPLEL80, mcPPLEO87, mcPPKOMU53, mcPPFINU60
   * mcPPUUT67, mcPPUEST74, mcPPUAUT88
   @  5,60 GET mPPLEL80 PICTURE "99999999.99"
   @  6,60 GET mPPLEO87 PICTURE "99999999.99"
   @  7,60 GET mPPKOMU53 PICTURE "99999999.99"
   @  8,60 GET mPPFINU60 PICTURE "99999999.99"
   @  9,60 GET mPPUUT67 PICTURE "99999999.99"
   @ 10,60 GET mPPUEST74 PICTURE "99999999.99"
   @ 11,60 GET mPPUAUT88 PICTURE "99999999.99"
   * kraj polja za kumulative

   READ
   IF Lastkey() = 27
      EXIT
   ENDIF

   @ 22,10 SAY "UPIS PODATAKA? (D/N) " GET dn PICTURE "!" VALID(dn $ "DdNn")
   READ

   IF Lastkey() = 27
      EXIT
   ENDIF

   IF dn = "N"
      LOOP
   ENDIF

   APPEND BLANK
   REPLACE DPLACPOR WITH mDplacpor
   REPLACE PER      WITH mPer
   REPLACE OZPER    WITH mOzper
   REPLACE BRNAL    WITH mBrnal
   REPLACE PPOP73   WITH mPPOP73
   REPLACE PPUS05   WITH mPPUS05
   REPLACE PPNV46   WITH mPPNV46
   REPLACE PPSREC81 WITH mPPSREC81
   REPLACE PPKPC03  WITH mPPKPC03
   REPLACE PORNDO22 WITH mPORNDO22
   REPLACE DOPVL43  WITH mDOPVL43
   REPLACE FINTRA50 WITH mFINTRA50
   REPLACE PORIM82  WITH mPORIM82
   REPLACE PORSRE66 WITH mPORSRE66
   REPLACE PORPAU36 WITH mPORPAU36
   REPLACE GGZEM    WITH mGGZEM
   REPLACE REZ1     WITH mREZ1
   REPLACE REZ2     WITH mREZ2
   REPLACE REZ3     WITH mREZ3
   REPLACE REZ11    WITH mREZ11
   REPLACE REZ22    WITH mREZ22
   REPLACE REZ33    WITH mREZ33

   REPLACE PPLEL80  WITH mPPLEL80
   REPLACE PPLEO87  WITH mPPLEO87
   REPLACE PPKOMU53 WITH mPPKOMU53
   REPLACE PPFINU60 WITH mPPFINU60
   REPLACE PPUUT67  WITH mPPUUT67
   REPLACE PPUEST74 WITH mPPUEST74
   REPLACE PPUAUT88 WITH mPPUAUT88

   SELECT PLACPNAS
   GO BOTTOM
   REPLACE CPPKPC03  WITH mcPPKPC03
   REPLACE CPORNDO22 WITH mcPORNDO22
   REPLACE CDOPVL43  WITH mcDOPVL43
   REPLACE CFINTRA50 WITH mcFINTRA50
   REPLACE CPORIM82  WITH mcPORIM82
   REPLACE CPORSRE66 WITH mcPORSRE66
   REPLACE CPORPAU36 WITH mcPORPAU36
   REPLACE CGGZEM    WITH mcGGZEM
   * REPLACE CPPLEL80  WITH mcPPLEL80
   * REPLACE CPPLEO87  WITH mcPPLEO87
   * REPLACE CPPKOMU53 WITH mcPPKOMU53
   * REPLACE CPPFINU60 WITH mcPPFINU60
   * REPLACE CPPUUT67  WITH mcPPUUT67
   * REPLACE CPPUEST74 WITH mcPPUEST74
   * REPLACE CPPUAUT88 WITH mcPPUAUT88

   * mcPPKPC03  = CPPKPC03
   * mcPORNDO22 = CPORNDO22
   * mcDOPVL43  = CDOPVL43
   * mcFINTRA50 = CFINTRA50
   * mcPORIM82  = CPORIM82
   * mcPORSRE66 = CPORSRE66
   * mcPORPAU36 = CPORPAU36
   * mcGGZEM    = CGGZEM

   * mcPPLEL80  = Space(18)
   * mcPPLEO87  = Space(18)
   * mcPPKOMU53 = Space(18)
   * mcPPFINU60 = Space(18)
   * mcPPUUT67  = Space(18)
   * mcPPUEST74 = Space(18)
   * mcPPUAUT88 = Space(18)

   SELECT PLACP
   mDplacpor = Date()
   mPPOP73   = 0
   mPPUS05   = 0
   mPPNV46   = 0
   mPPSREC81 = 0
   mPPKPC03  = 0
   mPORNDO22 = 0
   mDOPVL43  = 0
   mFINTRA50 = 0
   mPORIM82  = 0
   mPORSRE66 = 0
   mPORPAU36 = 0
   mGGZEM    = 0

   mREZ1     = 0
   mREZ2     = 0
   mREZ3     = 0
   mREZ11    = Space(18)
   mREZ22    = Space(18)
   mREZ33    = Space(18)
   mPPLEL80  = 0
   mPPLEO87  = 0
   mPPKOMU53 = 0
   mPPFINU60 = 0
   mPPUUT67  = 0
   mPPUEST74 = 0
   mPPUAUT88 = 0
   mBrnal    = 0
   mPer      = 0
   mOzPer    = 0
ENDDO

CLOSE PLACP
CLOSE PLACPNAS

RETURN

****************************************************************
* Kreira bazu - PLACP - podaci o placenim porezima
****************************************************************
FUNCTION DbPlacp
   LOCAL Broj, i, p1
   IF ! File("PLACP.DBF")
      CREATE RADNA
      STORE "DPLACPOR  D8  " TO POLJE1
      STORE "PER       N1  " TO POLJE2
      STORE "OZPER     N1  " TO POLJE3
      STORE "BRNAL     N5  " TO POLJE4
      STORE "PPOP73    N112" TO POLJE5
      STORE "PPUS05    N112" TO POLJE6
      STORE "PPNV46    N112" TO POLJE7
      STORE "PPSREC81  N112" TO POLJE8
      STORE "PPKPC03   N112" TO POLJE9
      STORE "PORNDO22  N112" TO POLJE10
      STORE "DOPVL43   N112" TO POLJE11
      STORE "FINTRA50  N112" TO POLJE12
      STORE "PORIM82   N112" TO POLJE13
      STORE "PORSRE66  N112" TO POLJE14
      STORE "PORPAU36  N112" TO POLJE15
      STORE "GGZEM     N112" TO POLJE16
      STORE "REZ1      N112" TO POLJE17
      STORE "REZ2      N112" TO POLJE18
      STORE "REZ3      N112" TO POLJE19
      STORE "REZ11     C18 " TO POLJE20
      STORE "REZ22     C18 " TO POLJE21
      STORE "REZ33     C18 " TO POLJE22
      STORE "PPLEL80   N112" TO POLJE23
      STORE "PPLEO87   N112" TO POLJE24
      STORE "PPKOMU53  N112" TO POLJE25
      STORE "PPFINU60  N112" TO POLJE26
      STORE "PPUUT67   N112" TO POLJE27
      STORE "PPUEST74  N112" TO POLJE28
      STORE "PPUAUT88  N112" TO POLJE29
      FOR I = 1 TO 29
         IF I > 9
            STORE Str(I,2) TO BROJ
         ELSE
            STORE Str(I,1) TO BROJ
         ENDIF
         P1 = "POLJE" + BROJ
         APPEND BLANK
         REPLACE FIELD_NAME WITH Substr(&P1,1,10)
         REPLACE FIELD_TYPE WITH Substr(&P1,11,1)
         REPLACE FIELD_LEN  WITH Val(Substr(&P1,12,2))
         REPLACE FIELD_DEC  WITH Val(Substr(&P1,14,1))
      NEXT I
      CREATE PLACP FROM RADNA
      INDEX ON DPLACPOR TO PLACP
      USE
      ERASE RADNA.DBF
      RETURN .T.     && Baza kreirana
   ENDIF
RETURN .F.           && Baza nije kreirana
****************************************************************

****************************************************************
* Kreira bazu - PLACPNAS - podaci o imenima placenih poreza
****************************************************************
FUNCTION DbPlacpnas
   LOCAL Broj, i, p1
   IF ! File("PLACPNAS.DBF")
      CREATE RADNA
      STORE "CPPKPC03  C18 " TO POLJE1
      STORE "CPORNDO22 C18 " TO POLJE2
      STORE "CDOPVL43  C18 " TO POLJE3
      STORE "CFINTRA50 C18 " TO POLJE4
      STORE "CPORIM82  C18 " TO POLJE5
      STORE "CPORSRE66 C18 " TO POLJE6
      STORE "CPORPAU36 C18 " TO POLJE7
      STORE "CGGZEM    C18 " TO POLJE8
      STORE "CPPLEL80  C18 " TO POLJE9
      STORE "CPPLEO87  C18 " TO POLJE10
      STORE "CPPKOMU53 C18 " TO POLJE11
      STORE "CPPFINU60 C18 " TO POLJE12
      STORE "CPPUUT67  C18 " TO POLJE13
      STORE "CPPUEST74 C18 " TO POLJE14
      STORE "CPPUAUT88 C18 " TO POLJE15
      FOR I = 1 TO 15
         IF I > 9
            STORE Str(I,2) TO BROJ
         ELSE
            STORE Str(I,1) TO BROJ
         ENDIF
         P1 = "POLJE" + BROJ
         APPEND BLANK
         REPLACE FIELD_NAME WITH Substr(&P1,1,10)
         REPLACE FIELD_TYPE WITH Substr(&P1,11,1)
         REPLACE FIELD_LEN  WITH Val(Substr(&P1,12,2))
         REPLACE FIELD_DEC  WITH Val(Substr(&P1,14,1))
      NEXT I
      CREATE PLACPNAS FROM RADNA
      APPEND BLANK
      USE
      ERASE RADNA.DBF
      RETURN .T.     && Baza kreirana
   ENDIF
RETURN .F.           && Baza nije kreirana
****************************************************************
