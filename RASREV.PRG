LOCAL wZbSveR, wZbSveS

IF ! FILE ("KONTROLA.DBF")
	CREATE RADNA
	STORE "RB        N5  " TO POLJE1
	STORE "KBR       C10 " TO POLJE2
	STORE "KDAT      D8  " TO POLJE3
	STORE "KKAL      N152" TO POLJE4
	STORE "KRAS      N152" TO POLJE5
	STORE "KPOR      N152" TO POLJE6
	FOR I = 1 TO 6
		STORE STR(I,1) TO BROJ
		STORE "POLJE" + BROJ TO P1
		APPEND BLANK
		REPLACE FIELD_NAME WITH SUBSTR(&P1,1,10)
		REPLACE FIELD_TYPE WITH SUBSTR(&P1,11,1)
		REPLACE FIELD_LEN WITH VAL(SUBSTR(&P1,12,2))
		REPLACE FIELD_DEC WITH VAL(SUBSTR(&P1,14,1))
	NEXT I
	CREATE KONTROLA FROM RADNA
	USE
	ERASE RADNA.DBF
ENDIF

SELECT 0
USE RASHODN INDEX RASHINKN
SELECT 0
USE KONTROLA
ZAP
GO TOP

SELECT RASHODN
DO WHILE ! Eof()
   IF RSVEP = 0 .AND. (RPV + RPN + RUSP) = 0
      SKIP
      LOOP
   ENDIF

   wZbSveR = RSVEP
   wZbSveS = round(RPV + RPN + RUSP,2)

	SELECT KONTROLA
	APPEND BLANK
	REPLACE KDAT WITH RASHODN->RDK
	REPLACE KKAL WITH ROUND(wZbSveS - wZbSveR,2)
	REPLACE KRAS WITH wZbSveS
	REPLACE KPOR WITH wZbSveR

	SELECT RASHODN
   SKIP
ENDDO

CLOSE DATABASES

CLEAR SCREEN
@ 0, 0 TO 24,79 DOUBLE
@ 1,1 SAY Centriraj("LISTANJA ZBIROVA PAZARA U PRIHOD-RASHOD I POREZU", 78)
@ 3,2  SAY "ENTER - izmena polja(zapamtite prethodnu vrednost)"
@ 4,2  SAY "DELETE - brisanje cele stavke"
@ 5,2  SAY "ALT/N - unos nove stavke"

DO LISTBAZA WITH 8,5,22,75,"kontrola"

RETURN
